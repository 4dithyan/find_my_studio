{% load static %}
{% include 'Customer/header.html' %}
<script src="{% static 'jquery-3.7.1.min.js' %}"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    $(document).ready(function() {
        $.ajaxSetup({
            headers: { "X-CSRFToken": '{{csrf_token}}' }
        });

        // When a district is selected
        $('#districtid').change(function () {
            var districtid = $(this).val();
            $.ajax({
                type: "POST",
                url: '{% url "filllocations" %}', 
                data: { did: districtid },
                dataType: "json",
                success: function (data) {
                    $('#location').empty(); 
                    $('#location').append('<option value="">--Select Location--</option>');

                    $.each(data, function (key, val) {
                        $('#location').append('<option value="' + val.locationid + '">' + val.locationname + '</option>');
                    });
                }
            });
        });

        // When a location is selected
        $('#location').change(function () {
            var locationid = $(this).val();
            if (locationid) {
                $.ajax({
                    type: "POST",
                    url: '{% url "fillstudios" %}', 
                    data: { lid: locationid },
                    dataType: "json",
                    success: function (data) {
                        $('#studios').empty(); 
                        if (data.length > 0) {
                            $.each(data, function (key, studio) {
                                var studioCard = `
                                    <div class="col-md-4 d-flex align-items-stretch">
                                        <div class="single_team">
                                            <div class="team_thumb">
                                                <a href="/customerapp/categoryview/${studio.studioid}">
                                                    <img src="${studio.simage}" alt="${studio.studioname}">
                                                </a>
                                            </div>
                                            <div class="team_info">
                                                <h3>${studio.studioname}</h3>
                                                <button class="btn btn-primary mt-2 view-reviews" data-studioid="${studio.studioid}" data-toggle="modal" data-target="#reviewModal">View Reviews</button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                $('#studios').append(studioCard);
                            });
                        } else {
                            $('#studios').append('<p>No studios available for this location.</p>');
                        }
                    }
                });
            } else {
                $('#studios').empty(); 
            }
        });

        // When clicking on "View Reviews" button
        $(document).on('click', '.view-reviews', function () {
            var studioid = $(this).data('studioid');

            $.ajax({
                type: "POST",
                url: '{% url "fetchreviews" %}', 
                data: { studioid: studioid },
                dataType: "json",
                success: function (data) {
                    $('#reviewsList').empty();
                    if (data.length > 0) {
                        $.each(data, function (key, review) {
    var stars = '‚≠ê'.repeat(review.rating);
    var reviewItem = `
        <div class="review-item">
            <p><strong>${review.customername}:</strong></p>
            <p>${review.description}</p>
            <p>Rating: ${stars}</p>
            <hr>
        </div>
    `;
    $('#reviewsList').append(reviewItem);
});
                    } else {
                        $('#reviewsList').html('<p>No reviews available for this studio.</p>');
                    }
                }
            });
        });
    });
</script>

<br><br><br>

<div class="photography_skill_area">
    <div class="section_title text-center">
        <h3>Find My Studio</h3>
        <div class="container mt-5">
            <div class="row">
                <!-- District Dropdown -->
                <div class="col-md-6 mb-4">
                    <select name="district" id="districtid" class="form-control custom-dropdown" style="height: 50px;" required>
                        <option value="">--Choose District--</option>
                        {% for d in district %}
                            <option value="{{ d.districtid }}">{{ d.districtname }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Location Dropdown -->
                <div class="col-md-6 mb-4">
                    <select name="location" id="location" class="form-control custom-dropdown" style="height: 50px;" required>
                        <option value="">--Choose Location--</option>
                    </select>
                </div>
            </div>

            <!-- Studios Section -->
            <div class="team_area">
                <div class="row" id="studios">
                    <!-- Studios will be dynamically added here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Review Modal -->
<div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reviewModalLabel">Studio Reviews</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="reviewsList">
                    <!-- Reviews will be loaded here dynamically -->
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .row {
        margin: 20px 0;
    }

    .custom-dropdown {
        width: 100%; 
        padding: 10px;
        font-size: 16px;
    }

    .form-control {
        border-radius: 4px;
        padding: 10px;
        font-size: 16px;
    }

    .team_area {
        padding-top: 8px;
        margin-top: 30px;
    }

    .single_team {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        height: 350px;
        text-align: center;
        width: 100%;
    }

    .team_thumb img {
        width: 100%; 
        height: 200px; 
        object-fit: cover; 
        border-radius: 4px;
    }

    .team_info {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;
    }

    .team_info h3 {
        font-size: 18px;
        margin-top: 10px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
        padding: 8px 12px;
        border-radius: 5px;
        text-decoration: none;
        font-size: 14px;
    }

    .btn-primary:hover {
        background-color: #0056b3;
    }
</style>

<br><br><br><br><br><br><br><br>
{% include 'Customer/footer.html' %}
